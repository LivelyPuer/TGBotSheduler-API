# Telegram Bot Scheduler

Этот сервис позволяет планировать отправку сообщений (текст и картинки) в Telegram каналы или группы через API.

## Структура проекта

- `main.py` - Основной файл приложения (FastAPI + APScheduler).
- `bot_service.py` - Логика отправки сообщений через Aiogram.
- `schemas.py` - Pydantic модели для валидации данных (используется для типизации, но основной прием данных теперь через Form Data).
- `jobs.sqlite` - База данных для хранения запланированных задач (создается автоматически).
- `media/` - Папка для сохранения загруженных файлов.

## Установка и запуск

1.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

2.  **Настройте переменные окружения:**
    Откройте файл `.env` и вставьте токен вашего бота:
    ```env
    BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
    ```
    *Токен можно получить у @BotFather.*

3.  **Запустите сервер:**
    ```bash
    python main.py
    ```
    Сервер запустится на `http://0.0.0.0:8000`.

## Использование API

### Swagger UI
Документация API доступна по адресу: http://localhost:8000/docs

### Эндпоинт `/schedule` (POST)

**Тип запроса:** `multipart/form-data` (так как поддерживается загрузка файлов).

**Параметры:**

| Поле | Тип | Обязательно | Описание |
|---|---|---|---|
| `chat_id` | string | Да | ID канала/группы (число) или юзернейм (`@channel`). |
| `text` | string | Нет | Текст сообщения. |
| `publish_at` | datetime | Да | Время публикации в UTC (ISO 8601, например `2024-12-31T15:00:00Z`). |
| `photo_urls` | list[str] | Нет | Список URL картинок (можно передавать несколько раз). |
| `files` | list[file] | Нет | Файлы картинок для загрузки. |

**Пример использования (curl):**

```bash
curl -X 'POST' \
  'http://localhost:8000/schedule' \
  -F 'chat_id=@my_test_channel' \
  -F 'text=Привет с файлом!' \
  -F 'publish_at=2024-12-31T15:00:00Z' \
  -F 'files=@/path/to/image1.jpg' \
  -F 'files=@/path/to/image2.png'
```

**Важно:**
- Бот должен быть администратором канала!
- Картинки, загруженные файлами, сохраняются в папку `media/` на сервере.
- Можно комбинировать `photo_urls` и `files`.

### Эндпоинт `/jobs` (GET)
Возвращает список запланированных задач.
